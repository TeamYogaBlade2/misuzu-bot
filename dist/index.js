var Wt=Object.create;var Te=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var Lt=Object.getOwnPropertyNames;var Vt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty;var Ft=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Kt=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Lt(t))!Bt.call(e,s)&&s!==r&&Te(e,s,{get:()=>t[s],enumerable:!(n=Mt(t,s))||n.enumerable});return e};var Jt=(e,t,r)=>(r=e!=null?Wt(Vt(e)):{},Kt(t||!e||!e.__esModule?Te(r,"default",{value:e,enumerable:!0}):r,e));var Ne=Ft((cs,R)=>{"use strict";var M=function(){};M.prototype=Object.create(null);var H=/; *([!#$%&'*+.^\w`|~-]+)=("(?:[\v\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\v\u0020-\u00ff])*"|[!#$%&'*+.^\w`|~-]+) */gu,W=/\\([\v\u0020-\u00ff])/gu,Ue=/^[!#$%&'*+.^\w|~-]+\/[!#$%&'*+.^\w|~-]+$/u,k={type:"",parameters:new M};Object.freeze(k.parameters);Object.freeze(k);function ze(e){if(typeof e!="string")throw new TypeError("argument header is required and must be a string");let t=e.indexOf(";"),r=t!==-1?e.slice(0,t).trim():e.trim();if(Ue.test(r)===!1)throw new TypeError("invalid media type");let n={type:r.toLowerCase(),parameters:new M};if(t===-1)return n;let s,o,i;for(H.lastIndex=t;o=H.exec(e);){if(o.index!==t)throw new TypeError("invalid parameter format");t+=o[0].length,s=o[1].toLowerCase(),i=o[2],i[0]==='"'&&(i=i.slice(1,i.length-1),W.test(i)&&(i=i.replace(W,"$1"))),n.parameters[s]=i}if(t!==e.length)throw new TypeError("invalid parameter format");return n}function Pe(e){if(typeof e!="string")return k;let t=e.indexOf(";"),r=t!==-1?e.slice(0,t).trim():e.trim();if(Ue.test(r)===!1)return k;let n={type:r.toLowerCase(),parameters:new M};if(t===-1)return n;let s,o,i;for(H.lastIndex=t;o=H.exec(e);){if(o.index!==t)return k;t+=o[0].length,s=o[1].toLowerCase(),i=o[2],i[0]==='"'&&(i=i.slice(1,i.length-1),W.test(i)&&(i=i.replace(W,"$1"))),n.parameters[s]=i}return t!==e.length?k:n}R.exports.default={parse:ze,safeParse:Pe};R.exports.parse=ze;R.exports.safeParse=Pe;R.exports.defaultContentType=k});function f(){return typeof navigator=="object"&&"userAgent"in navigator?navigator.userAgent:typeof process=="object"&&process.version!==void 0?`Node.js/${process.version.substr(1)} (${process.platform}; ${process.arch})`:"<environment undetectable>"}function C(e,t,r,n){if(typeof r!="function")throw new Error("method for before hook must be a function");return n||(n={}),Array.isArray(t)?t.reverse().reduce((s,o)=>C.bind(null,e,o,s,n),r)():Promise.resolve().then(()=>e.registry[t]?e.registry[t].reduce((s,o)=>o.hook.bind(null,s,n),r)():r(n))}function ke(e,t,r,n){let s=n;e.registry[r]||(e.registry[r]=[]),t==="before"&&(n=(o,i)=>Promise.resolve().then(s.bind(null,i)).then(o.bind(null,i))),t==="after"&&(n=(o,i)=>{let a;return Promise.resolve().then(o.bind(null,i)).then(c=>(a=c,s(a,i))).then(()=>a)}),t==="error"&&(n=(o,i)=>Promise.resolve().then(o.bind(null,i)).catch(a=>s(a,i))),e.registry[r].push({hook:n,orig:s})}function Ee(e,t,r){if(!e.registry[t])return;let n=e.registry[t].map(s=>s.orig).indexOf(r);n!==-1&&e.registry[t].splice(n,1)}var ve=Function.bind,Ae=ve.bind(ve);function Se(e,t,r){let n=Ae(Ee,null).apply(null,r?[t,r]:[t]);e.api={remove:n},e.remove=n,["before","error","after","wrap"].forEach(s=>{let o=r?[t,s,r]:[t,s];e[s]=e.api[s]=Ae(ke,null).apply(null,o)})}function Yt(){let e=Symbol("Singular"),t={registry:{}},r=C.bind(null,t,e);return Se(r,t,e),r}function Qt(){let e={registry:{}},t=C.bind(null,e);return Se(t,e),t}var Ge={Singular:Yt,Collection:Qt};var Xt="0.0.0-development",Zt=`octokit-endpoint.js/${Xt} ${f()}`,er={method:"GET",baseUrl:"https://api.github.com",headers:{accept:"application/vnd.github.v3+json","user-agent":Zt},mediaType:{format:""}};function tr(e){return e?Object.keys(e).reduce((t,r)=>(t[r.toLowerCase()]=e[r],t),{}):{}}function rr(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;let t=Object.getPrototypeOf(e);if(t===null)return!0;let r=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Function.prototype.call(r)===Function.prototype.call(e)}function je(e,t){let r=Object.assign({},e);return Object.keys(t).forEach(n=>{rr(t[n])?n in e?r[n]=je(e[n],t[n]):Object.assign(r,{[n]:t[n]}):Object.assign(r,{[n]:t[n]})}),r}function Oe(e){for(let t in e)e[t]===void 0&&delete e[t];return e}function oe(e,t,r){if(typeof t=="string"){let[s,o]=t.split(" ");r=Object.assign(o?{method:s,url:o}:{url:s},r)}else r=Object.assign({},t);r.headers=tr(r.headers),Oe(r),Oe(r.headers);let n=je(e||{},r);return r.url==="/graphql"&&(e&&e.mediaType.previews?.length&&(n.mediaType.previews=e.mediaType.previews.filter(s=>!n.mediaType.previews.includes(s)).concat(n.mediaType.previews)),n.mediaType.previews=(n.mediaType.previews||[]).map(s=>s.replace(/-preview/,""))),n}function nr(e,t){let r=/\?/.test(e)?"&":"?",n=Object.keys(t);return n.length===0?e:e+r+n.map(s=>s==="q"?"q="+t.q.split("+").map(encodeURIComponent).join("+"):`${s}=${encodeURIComponent(t[s])}`).join("&")}var sr=/\{[^{}}]+\}/g;function or(e){return e.replace(/(?:^\W+)|(?:(?<!\W)\W+$)/g,"").split(/,/)}function ir(e){let t=e.match(sr);return t?t.map(or).reduce((r,n)=>r.concat(n),[]):[]}function xe(e,t){let r={__proto__:null};for(let n of Object.keys(e))t.indexOf(n)===-1&&(r[n]=e[n]);return r}function Ie(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map(function(t){return/%[0-9A-Fa-f]/.test(t)||(t=encodeURI(t).replace(/%5B/g,"[").replace(/%5D/g,"]")),t}).join("")}function S(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function $(e,t,r){return t=e==="+"||e==="#"?Ie(t):S(t),r?S(r)+"="+t:t}function A(e){return e!=null}function se(e){return e===";"||e==="&"||e==="?"}function ar(e,t,r,n){var s=e[r],o=[];if(A(s)&&s!=="")if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")s=s.toString(),n&&n!=="*"&&(s=s.substring(0,parseInt(n,10))),o.push($(t,s,se(t)?r:""));else if(n==="*")Array.isArray(s)?s.filter(A).forEach(function(i){o.push($(t,i,se(t)?r:""))}):Object.keys(s).forEach(function(i){A(s[i])&&o.push($(t,s[i],i))});else{let i=[];Array.isArray(s)?s.filter(A).forEach(function(a){i.push($(t,a))}):Object.keys(s).forEach(function(a){A(s[a])&&(i.push(S(a)),i.push($(t,s[a].toString())))}),se(t)?o.push(S(r)+"="+i.join(",")):i.length!==0&&o.push(i.join(","))}else t===";"?A(s)&&o.push(S(r)):s===""&&(t==="&"||t==="?")?o.push(S(r)+"="):s===""&&o.push("");return o}function cr(e){return{expand:ur.bind(null,e)}}function ur(e,t){var r=["+","#",".","/",";","?","&"];return e=e.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(n,s,o){if(s){let a="",c=[];if(r.indexOf(s.charAt(0))!==-1&&(a=s.charAt(0),s=s.substr(1)),s.split(/,/g).forEach(function(p){var l=/([^:\*]*)(?::(\d+)|(\*))?/.exec(p);c.push(ar(t,a,l[1],l[2]||l[3]))}),a&&a!=="+"){var i=",";return a==="?"?i="&":a!=="#"&&(i=a),(c.length!==0?a:"")+c.join(i)}else return c.join(",")}else return Ie(o)}),e==="/"?e:e.replace(/\/$/,"")}function qe(e){let t=e.method.toUpperCase(),r=(e.url||"/").replace(/:([a-z]\w+)/g,"{$1}"),n=Object.assign({},e.headers),s,o=xe(e,["method","baseUrl","url","headers","request","mediaType"]),i=ir(r);r=cr(r).expand(o),/^http/.test(r)||(r=e.baseUrl+r);let a=Object.keys(e).filter(l=>i.includes(l)).concat("baseUrl"),c=xe(o,a);if(!/application\/octet-stream/i.test(n.accept)&&(e.mediaType.format&&(n.accept=n.accept.split(/,/).map(l=>l.replace(/application\/vnd(\.\w+)(\.v3)?(\.\w+)?(\+json)?$/,`application/vnd$1$2.${e.mediaType.format}`)).join(",")),r.endsWith("/graphql")&&e.mediaType.previews?.length)){let l=n.accept.match(/(?<![\w-])[\w-]+(?=-preview)/g)||[];n.accept=l.concat(e.mediaType.previews).map(u=>{let d=e.mediaType.format?`.${e.mediaType.format}`:"+json";return`application/vnd.github.${u}-preview${d}`}).join(",")}return["GET","HEAD"].includes(t)?r=nr(r,c):"data"in c?s=c.data:Object.keys(c).length&&(s=c),!n["content-type"]&&typeof s<"u"&&(n["content-type"]="application/json; charset=utf-8"),["PATCH","PUT"].includes(t)&&typeof s>"u"&&(s=""),Object.assign({method:t,url:r,headers:n},typeof s<"u"?{body:s}:null,e.request?{request:e.request}:null)}function lr(e,t,r){return qe(oe(e,t,r))}function $e(e,t){let r=oe(e,t),n=lr.bind(null,r);return Object.assign(n,{DEFAULTS:r,defaults:$e.bind(null,r),merge:oe.bind(null,r),parse:qe})}var Re=$e(null,er);var Ce=Jt(Ne(),1);var b=class extends Error{name;status;request;response;constructor(t,r,n){super(t),this.name="HttpError",this.status=Number.parseInt(r),Number.isNaN(this.status)&&(this.status=0),"response"in n&&(this.response=n.response);let s=Object.assign({},n.request);n.request.headers.authorization&&(s.headers=Object.assign({},n.request.headers,{authorization:n.request.headers.authorization.replace(/(?<! ) .*$/," [REDACTED]")})),s.url=s.url.replace(/\bclient_secret=\w+/g,"client_secret=[REDACTED]").replace(/\baccess_token=\w+/g,"access_token=[REDACTED]"),this.request=s}};var pr="10.0.5",dr={headers:{"user-agent":`octokit-request.js/${pr} ${f()}`}};function hr(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;let t=Object.getPrototypeOf(e);if(t===null)return!0;let r=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Function.prototype.call(r)===Function.prototype.call(e)}async function De(e){let t=e.request?.fetch||globalThis.fetch;if(!t)throw new Error("fetch is not set. Please pass a fetch implementation as new Octokit({ request: { fetch }}). Learn more at https://github.com/octokit/octokit.js/#fetch-missing");let r=e.request?.log||console,n=e.request?.parseSuccessResponseBody!==!1,s=hr(e.body)||Array.isArray(e.body)?JSON.stringify(e.body):e.body,o=Object.fromEntries(Object.entries(e.headers).map(([u,d])=>[u,String(d)])),i;try{i=await t(e.url,{method:e.method,body:s,redirect:e.request?.redirect,headers:o,signal:e.request?.signal,...e.body&&{duplex:"half"}})}catch(u){let d="Unknown Error";if(u instanceof Error){if(u.name==="AbortError")throw u.status=500,u;d=u.message,u.name==="TypeError"&&"cause"in u&&(u.cause instanceof Error?d=u.cause.message:typeof u.cause=="string"&&(d=u.cause))}let m=new b(d,500,{request:e});throw m.cause=u,m}let a=i.status,c=i.url,p={};for(let[u,d]of i.headers)p[u]=d;let l={url:c,status:a,headers:p,data:""};if("deprecation"in p){let u=p.link&&p.link.match(/<([^<>]+)>; rel="deprecation"/),d=u&&u.pop();r.warn(`[@octokit/request] "${e.method} ${e.url}" is deprecated. It is scheduled to be removed on ${p.sunset}${d?`. See ${d}`:""}`)}if(a===204||a===205)return l;if(e.method==="HEAD"){if(a<400)return l;throw new b(i.statusText,a,{response:l,request:e})}if(a===304)throw l.data=await ie(i),new b("Not modified",a,{response:l,request:e});if(a>=400)throw l.data=await ie(i),new b(mr(l.data),a,{response:l,request:e});return l.data=n?await ie(i):i.body,l}async function ie(e){let t=e.headers.get("content-type");if(!t)return e.text().catch(()=>"");let r=(0,Ce.safeParse)(t);if(fr(r)){let n="";try{return n=await e.text(),JSON.parse(n)}catch{return n}}else return r.type.startsWith("text/")||r.parameters.charset?.toLowerCase()==="utf-8"?e.text().catch(()=>""):e.arrayBuffer().catch(()=>new ArrayBuffer(0))}function fr(e){return e.type==="application/json"||e.type==="application/scim+json"}function mr(e){if(typeof e=="string")return e;if(e instanceof ArrayBuffer)return"Unknown error";if("message"in e){let t="documentation_url"in e?` - ${e.documentation_url}`:"";return Array.isArray(e.errors)?`${e.message}: ${e.errors.map(r=>JSON.stringify(r)).join(", ")}${t}`:`${e.message}${t}`}return`Unknown error: ${JSON.stringify(e)}`}function ae(e,t){let r=e.defaults(t);return Object.assign(function(s,o){let i=r.merge(s,o);if(!i.request||!i.request.hook)return De(r.parse(i));let a=(c,p)=>De(r.parse(r.merge(c,p)));return Object.assign(a,{endpoint:r,defaults:ae.bind(null,r)}),i.request.hook(a,i)},{endpoint:r,defaults:ae.bind(null,r)})}var h=ae(Re,dr);var gr="0.0.0-development";function yr(e){return`Request failed due to following response errors:
`+e.errors.map(t=>` - ${t.message}`).join(`
`)}var wr=class extends Error{constructor(e,t,r){super(yr(r)),this.request=e,this.headers=t,this.response=r,this.errors=r.errors,this.data=r.data,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}name="GraphqlResponseError";errors;data},br=["method","baseUrl","url","headers","request","query","mediaType","operationName"],_r=["query","method","url"],He=/\/api\/v3\/?$/;function Tr(e,t,r){if(r){if(typeof t=="string"&&"query"in r)return Promise.reject(new Error('[@octokit/graphql] "query" cannot be used as variable name'));for(let i in r)if(_r.includes(i))return Promise.reject(new Error(`[@octokit/graphql] "${i}" cannot be used as variable name`))}let n=typeof t=="string"?Object.assign({query:t},r):t,s=Object.keys(n).reduce((i,a)=>br.includes(a)?(i[a]=n[a],i):(i.variables||(i.variables={}),i.variables[a]=n[a],i),{}),o=n.baseUrl||e.endpoint.DEFAULTS.baseUrl;return He.test(o)&&(s.url=o.replace(He,"/api/graphql")),e(s).then(i=>{if(i.data.errors){let a={};for(let c of Object.keys(i.headers))a[c]=i.headers[c];throw new wr(s,a,i.data)}return i.data.data})}function ce(e,t){let r=e.defaults(t);return Object.assign((s,o)=>Tr(r,s,o),{defaults:ce.bind(null,r),endpoint:r.endpoint})}var gs=ce(h,{headers:{"user-agent":`octokit-graphql.js/${gr} ${f()}`},method:"POST",url:"/graphql"});function We(e){return ce(e,{method:"POST",url:"/graphql"})}var ue="(?:[a-zA-Z0-9_-]+)",Me="\\.",Le=new RegExp(`^${ue}${Me}${ue}${Me}${ue}$`),kr=Le.test.bind(Le);async function Er(e){let t=kr(e),r=e.startsWith("v1.")||e.startsWith("ghs_"),n=e.startsWith("ghu_");return{type:"token",token:e,tokenType:t?"app":r?"installation":n?"user-to-server":"oauth"}}function vr(e){return e.split(/\./).length===3?`bearer ${e}`:`token ${e}`}async function Ar(e,t,r,n){let s=t.endpoint.merge(r,n);return s.headers.authorization=vr(e),t(s)}var Ve=function(t){if(!t)throw new Error("[@octokit/auth-token] No token passed to createTokenAuth");if(typeof t!="string")throw new Error("[@octokit/auth-token] Token passed to createTokenAuth is not a string");return t=t.replace(/^(token|bearer) +/i,""),Object.assign(Er.bind(null,t),{hook:Ar.bind(null,t)})};var le="7.0.5";var Be=()=>{},Sr=console.warn.bind(console),Gr=console.error.bind(console);function Or(e={}){return typeof e.debug!="function"&&(e.debug=Be),typeof e.info!="function"&&(e.info=Be),typeof e.warn!="function"&&(e.warn=Sr),typeof e.error!="function"&&(e.error=Gr),e}var Fe=`octokit-core.js/${le} ${f()}`,G=class{static VERSION=le;static defaults(t){return class extends this{constructor(...n){let s=n[0]||{};if(typeof t=="function"){super(t(s));return}super(Object.assign({},t,s,s.userAgent&&t.userAgent?{userAgent:`${s.userAgent} ${t.userAgent}`}:null))}}}static plugins=[];static plugin(...t){let r=this.plugins;return class extends this{static plugins=r.concat(t.filter(s=>!r.includes(s)))}}constructor(t={}){let r=new Ge.Collection,n={baseUrl:h.endpoint.DEFAULTS.baseUrl,headers:{},request:Object.assign({},t.request,{hook:r.bind(null,"request")}),mediaType:{previews:[],format:""}};if(n.headers["user-agent"]=t.userAgent?`${t.userAgent} ${Fe}`:Fe,t.baseUrl&&(n.baseUrl=t.baseUrl),t.previews&&(n.mediaType.previews=t.previews),t.timeZone&&(n.headers["time-zone"]=t.timeZone),this.request=h.defaults(n),this.graphql=We(this.request).defaults(n),this.log=Or(t.log),this.hook=r,t.authStrategy){let{authStrategy:o,...i}=t,a=o(Object.assign({request:this.request,log:this.log,octokit:this,octokitOptions:i},t.auth));r.wrap("request",a.hook),this.auth=a}else if(!t.auth)this.auth=async()=>({type:"unauthenticated"});else{let o=Ve(t.auth);r.wrap("request",o.hook),this.auth=o}let s=this.constructor;for(let o=0;o<s.plugins.length;++o)Object.assign(this,s.plugins[o](this,t))}request;graphql;log;hook;auth};function Ke(e){let t=e.clientType||"oauth-app",r=e.baseUrl||"https://github.com",n={clientType:t,allowSignup:e.allowSignup!==!1,clientId:e.clientId,login:e.login||null,redirectUrl:e.redirectUrl||null,state:e.state||Math.random().toString(36).substr(2),url:""};if(t==="oauth-app"){let s="scopes"in e?e.scopes:[];n.scopes=typeof s=="string"?s.split(/[,\s]+/).filter(Boolean):s}return n.url=xr(`${r}/login/oauth/authorize`,n),n}function xr(e,t){let r={allowSignup:"allow_signup",clientId:"client_id",login:"login",redirectUrl:"redirect_uri",scopes:"scope",state:"state"},n=e;return Object.keys(r).filter(s=>t[s]!==null).filter(s=>s!=="scopes"?!0:t.clientType==="github-app"?!1:!Array.isArray(t[s])||t[s].length>0).map(s=>[r[s],`${t[s]}`]).forEach(([s,o],i)=>{n+=i===0?"?":"&",n+=`${s}=${encodeURIComponent(o)}`}),n}function Xe(e){let t=e.endpoint.DEFAULTS;return/^https:\/\/(api\.)?github\.com$/.test(t.baseUrl)?"https://github.com":t.baseUrl.replace("/api/v3","")}async function L(e,t,r){let n={baseUrl:Xe(e),headers:{accept:"application/json"},...r},s=await e(t,n);if("error"in s.data){let o=new b(`${s.data.error_description} (${s.data.error}, ${s.data.error_uri})`,400,{request:e.endpoint.merge(t,n)});throw o.response=s,o}return s}function Ze({request:e=h,...t}){let r=Xe(e);return Ke({...t,baseUrl:r})}async function et(e){let t=e.request||h,r=await L(t,"POST /login/oauth/access_token",{client_id:e.clientId,client_secret:e.clientSecret,code:e.code,redirect_uri:e.redirectUrl}),n={clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:r.data.access_token,scopes:r.data.scope.split(/\s+/).filter(Boolean)};if(e.clientType==="github-app"){if("refresh_token"in r.data){let s=new Date(r.headers.date).getTime();n.refreshToken=r.data.refresh_token,n.expiresAt=Je(s,r.data.expires_in),n.refreshTokenExpiresAt=Je(s,r.data.refresh_token_expires_in)}delete n.scopes}return{...r,authentication:n}}function Je(e,t){return new Date(e+t*1e3).toISOString()}async function tt(e){let t=e.request||h,r={client_id:e.clientId};return"scopes"in e&&Array.isArray(e.scopes)&&(r.scope=e.scopes.join(" ")),L(t,"POST /login/device/code",r)}async function pe(e){let t=e.request||h,r=await L(t,"POST /login/oauth/access_token",{client_id:e.clientId,device_code:e.code,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),n={clientType:e.clientType,clientId:e.clientId,token:r.data.access_token,scopes:r.data.scope.split(/\s+/).filter(Boolean)};if("clientSecret"in e&&(n.clientSecret=e.clientSecret),e.clientType==="github-app"){if("refresh_token"in r.data){let s=new Date(r.headers.date).getTime();n.refreshToken=r.data.refresh_token,n.expiresAt=Ye(s,r.data.expires_in),n.refreshTokenExpiresAt=Ye(s,r.data.refresh_token_expires_in)}delete n.scopes}return{...r,authentication:n}}function Ye(e,t){return new Date(e+t*1e3).toISOString()}async function V(e){let r=await(e.request||h)("POST /applications/{client_id}/token",{headers:{authorization:`basic ${btoa(`${e.clientId}:${e.clientSecret}`)}`},client_id:e.clientId,access_token:e.token}),n={clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:e.token,scopes:r.data.scopes};return r.data.expires_at&&(n.expiresAt=r.data.expires_at),e.clientType==="github-app"&&delete n.scopes,{...r,authentication:n}}async function B(e){let t=e.request||h,r=await L(t,"POST /login/oauth/access_token",{client_id:e.clientId,client_secret:e.clientSecret,grant_type:"refresh_token",refresh_token:e.refreshToken}),n=new Date(r.headers.date).getTime(),s={clientType:"github-app",clientId:e.clientId,clientSecret:e.clientSecret,token:r.data.access_token,refreshToken:r.data.refresh_token,expiresAt:Qe(n,r.data.expires_in),refreshTokenExpiresAt:Qe(n,r.data.refresh_token_expires_in)};return{...r,authentication:s}}function Qe(e,t){return new Date(e+t*1e3).toISOString()}async function rt(e){let{request:t,clientType:r,clientId:n,clientSecret:s,token:o,...i}=e,c=await(e.request||h)("POST /applications/{client_id}/token/scoped",{headers:{authorization:`basic ${btoa(`${n}:${s}`)}`},client_id:n,access_token:o,...i}),p=Object.assign({clientType:r,clientId:n,clientSecret:s,token:c.data.token},c.data.expires_at?{expiresAt:c.data.expires_at}:{});return{...c,authentication:p}}async function U(e){let t=e.request||h,r=btoa(`${e.clientId}:${e.clientSecret}`),n=await t("PATCH /applications/{client_id}/token",{headers:{authorization:`basic ${r}`},client_id:e.clientId,access_token:e.token}),s={clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:n.data.token,scopes:n.data.scopes};return n.data.expires_at&&(s.expiresAt=n.data.expires_at),e.clientType==="github-app"&&delete s.scopes,{...n,authentication:s}}async function z(e){let t=e.request||h,r=btoa(`${e.clientId}:${e.clientSecret}`);return t("DELETE /applications/{client_id}/token",{headers:{authorization:`basic ${r}`},client_id:e.clientId,access_token:e.token})}async function P(e){let t=e.request||h,r=btoa(`${e.clientId}:${e.clientSecret}`);return t("DELETE /applications/{client_id}/grant",{headers:{authorization:`basic ${r}`},client_id:e.clientId,access_token:e.token})}async function st(e,t){let r=jr(e,t.auth);if(r)return r;let{data:n}=await tt({clientType:e.clientType,clientId:e.clientId,request:t.request||e.request,scopes:t.auth.scopes||e.scopes});await e.onVerification(n);let s=await de(t.request||e.request,e.clientId,e.clientType,n);return e.authentication=s,s}function jr(e,t){if(t.refresh===!0||!e.authentication)return!1;if(e.clientType==="github-app")return e.authentication;let r=e.authentication,n=("scopes"in t&&t.scopes||e.scopes).join(" "),s=r.scopes.join(" ");return n===s?r:!1}async function nt(e){await new Promise(t=>setTimeout(t,e*1e3))}async function de(e,t,r,n){try{let s={clientId:t,request:e,code:n.device_code},{authentication:o}=r==="oauth-app"?await pe({...s,clientType:"oauth-app"}):await pe({...s,clientType:"github-app"});return{type:"token",tokenType:"oauth",...o}}catch(s){if(!s.response)throw s;let o=s.response.data.error;if(o==="authorization_pending")return await nt(n.interval),de(e,t,r,n);if(o==="slow_down")return await nt(n.interval+7),de(e,t,r,n);throw s}}async function Ir(e,t){return st(e,{auth:t})}async function qr(e,t,r,n){let s=t.endpoint.merge(r,n);if(/\/login\/(oauth\/access_token|device\/code)$/.test(s.url))return t(s);let{token:o}=await st(e,{request:t,auth:{type:"oauth"}});return s.headers.authorization=`token ${o}`,t(s)}var $r="0.0.0-development";function ot(e){let t=e.request||h.defaults({headers:{"user-agent":`octokit-auth-oauth-device.js/${$r} ${f()}`}}),{request:r=t,...n}=e,s=e.clientType==="github-app"?{...n,clientType:"github-app",request:r}:{...n,clientType:"oauth-app",request:r,scopes:e.scopes||[]};if(!e.clientId)throw new Error('[@octokit/auth-oauth-device] "clientId" option must be set (https://github.com/octokit/auth-oauth-device.js#usage)');if(!e.onVerification)throw new Error('[@octokit/auth-oauth-device] "onVerification" option must be a function (https://github.com/octokit/auth-oauth-device.js#usage)');return Object.assign(Ir.bind(null,s),{hook:qr.bind(null,s)})}var at="0.0.0-development";async function it(e){if("code"in e.strategyOptions){let{authentication:t}=await et({clientId:e.clientId,clientSecret:e.clientSecret,clientType:e.clientType,onTokenCreated:e.onTokenCreated,...e.strategyOptions,request:e.request});return{type:"token",tokenType:"oauth",...t}}if("onVerification"in e.strategyOptions){let r=await ot({clientType:e.clientType,clientId:e.clientId,onTokenCreated:e.onTokenCreated,...e.strategyOptions,request:e.request})({type:"oauth"});return{clientSecret:e.clientSecret,...r}}if("token"in e.strategyOptions)return{type:"token",tokenType:"oauth",clientId:e.clientId,clientSecret:e.clientSecret,clientType:e.clientType,onTokenCreated:e.onTokenCreated,...e.strategyOptions};throw new Error("[@octokit/auth-oauth-user] Invalid strategy options")}async function he(e,t={}){if(e.authentication||(e.authentication=e.clientType==="oauth-app"?await it(e):await it(e)),e.authentication.invalid)throw new Error("[@octokit/auth-oauth-user] Token is invalid");let r=e.authentication;if("expiresAt"in r&&(t.type==="refresh"||new Date(r.expiresAt)<new Date)){let{authentication:n}=await B({clientType:"github-app",clientId:e.clientId,clientSecret:e.clientSecret,refreshToken:r.refreshToken,request:e.request});e.authentication={tokenType:"oauth",type:"token",...n}}if(t.type==="refresh"){if(e.clientType==="oauth-app")throw new Error("[@octokit/auth-oauth-user] OAuth Apps do not support expiring tokens");if(!r.hasOwnProperty("expiresAt"))throw new Error("[@octokit/auth-oauth-user] Refresh token missing");await e.onTokenCreated?.(e.authentication,{type:t.type})}if(t.type==="check"||t.type==="reset"){let n=t.type==="check"?V:U;try{let{authentication:s}=await n({clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:e.authentication.token,request:e.request});return e.authentication={tokenType:"oauth",type:"token",...s},t.type==="reset"&&await e.onTokenCreated?.(e.authentication,{type:t.type}),e.authentication}catch(s){throw s.status===404&&(s.message="[@octokit/auth-oauth-user] Token is invalid",e.authentication.invalid=!0),s}}if(t.type==="delete"||t.type==="deleteAuthorization"){let n=t.type==="delete"?z:P;try{await n({clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:e.authentication.token,request:e.request})}catch(s){if(s.status!==404)throw s}return e.authentication.invalid=!0,e.authentication}return e.authentication}var Rr=/\/applications\/[^/]+\/(token|grant)s?/;function N(e){return e&&Rr.test(e)}async function Ur(e,t,r,n={}){let s=t.endpoint.merge(r,n);if(/\/login\/(oauth\/access_token|device\/code)$/.test(s.url))return t(s);if(N(s.url)){let i=btoa(`${e.clientId}:${e.clientSecret}`);return s.headers.authorization=`basic ${i}`,t(s)}let{token:o}=e.clientType==="oauth-app"?await he({...e,request:t}):await he({...e,request:t});return s.headers.authorization="token "+o,t(s)}function g({clientId:e,clientSecret:t,clientType:r="oauth-app",request:n=h.defaults({headers:{"user-agent":`octokit-auth-oauth-app.js/${at} ${f()}`}}),onTokenCreated:s,...o}){let i=Object.assign({clientType:r,clientId:e,clientSecret:t,onTokenCreated:s,strategyOptions:o,request:n});return Object.assign(he.bind(null,i),{hook:Ur.bind(null,i)})}g.VERSION=at;async function zr(e,t){if(t.type==="oauth-app")return{type:"oauth-app",clientId:e.clientId,clientSecret:e.clientSecret,clientType:e.clientType,headers:{authorization:`basic ${btoa(`${e.clientId}:${e.clientSecret}`)}`}};if("factory"in t){let{type:s,...o}={...t,...e};return t.factory(o)}let r={clientId:e.clientId,clientSecret:e.clientSecret,request:e.request,...t};return(e.clientType==="oauth-app"?await g({...r,clientType:e.clientType}):await g({...r,clientType:e.clientType}))()}async function Pr(e,t,r,n){let s=t.endpoint.merge(r,n);if(/\/login\/(oauth\/access_token|device\/code)$/.test(s.url))return t(s);if(e.clientType==="github-app"&&!N(s.url))throw new Error(`[@octokit/auth-oauth-app] GitHub Apps cannot use their client ID/secret for basic authentication for endpoints other than "/applications/{client_id}/**". "${s.method} ${s.url}" is not supported.`);let o=btoa(`${e.clientId}:${e.clientSecret}`);s.headers.authorization=`basic ${o}`;try{return await t(s)}catch(i){throw i.status!==401||(i.message=`[@octokit/auth-oauth-app] "${s.method} ${s.url}" does not support clientId/clientSecret basic authentication.`),i}}var Nr="0.0.0-development";function F(e){let t=Object.assign({request:h.defaults({headers:{"user-agent":`octokit-auth-oauth-app.js/${Nr} ${f()}`}}),clientType:"oauth-app"},e);return Object.assign(zr.bind(null,t),{hook:Pr.bind(null,t)})}function ut(e){return e.includes("-----BEGIN RSA PRIVATE KEY-----")}function lt(e){return e.includes("-----BEGIN OPENSSH PRIVATE KEY-----")}function fe(e){let t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let n=0,s=e.length;n<s;n++)r[n]=e.charCodeAt(n);return t}function pt(e){let t=e.trim().split(`
`).slice(1,-1).join(""),r=atob(t);return fe(r)}function dt(e,t){return`${ct(e)}.${ct(t)}`}function ht(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,s=0;s<n;s++)t+=String.fromCharCode(r[s]);return ft(btoa(t))}function ft(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ct(e){return ft(btoa(JSON.stringify(e)))}var{subtle:me}=globalThis.crypto;async function mt({privateKey:e,payload:t}){let r=e;if(ut(r))throw new Error("[universal-github-app-jwt] Private Key is in PKCS#1 format, but only PKCS#8 is supported. See https://github.com/gr2m/universal-github-app-jwt#private-key-formats");if(lt(r))throw new Error("[universal-github-app-jwt] Private Key is in OpenSSH format, but only PKCS#8 is supported. See https://github.com/gr2m/universal-github-app-jwt#private-key-formats");let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s={alg:"RS256",typ:"JWT"},o=pt(r),i=await me.importKey("pkcs8",o,n,!1,["sign"]),a=dt(s,t),c=fe(a),p=await me.sign(n.name,i,c),l=ht(p);return`${a}.${l}`}async function ge({id:e,privateKey:t,now:r=Math.floor(Date.now()/1e3)}){let n=t.replace(/\\n/g,`
`),s=r-30,o=s+600,a=await mt({privateKey:n,payload:{iat:s,exp:o,iss:e}});return{appId:e,expiration:o,token:a}}var K=class{constructor(t=1e3,r=0){if(isNaN(t)||t<0)throw new Error("Invalid max value");if(isNaN(r)||r<0)throw new Error("Invalid ttl value");this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this.max=t,this.ttl=r}bumpLru(t){if(this.last===t)return;let r=this.last,n=t.next,s=t.prev;this.first===t&&(this.first=n),t.next=null,t.prev=r,r.next=t,s!==null&&(s.next=n),n!==null&&(n.prev=s),this.last=t}clear(){this.items=Object.create(null),this.first=null,this.last=null,this.size=0}delete(t){if(Object.prototype.hasOwnProperty.call(this.items,t)){let r=this.items[t];delete this.items[t],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}}deleteMany(t){for(var r=0;r<t.length;r++)this.delete(t[r])}evict(){if(this.size>0){let t=this.first;delete this.items[t.key],--this.size===0?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}}expiresAt(t){if(Object.prototype.hasOwnProperty.call(this.items,t))return this.items[t].expiry}get(t){if(Object.prototype.hasOwnProperty.call(this.items,t)){let r=this.items[t];if(this.ttl>0&&r.expiry<=Date.now()){this.delete(t);return}return this.bumpLru(r),r.value}}getMany(t){let r=[];for(var n=0;n<t.length;n++)r.push(this.get(t[n]));return r}keys(){return Object.keys(this.items)}set(t,r){if(Object.prototype.hasOwnProperty.call(this.items,t)){let s=this.items[t];s.value=r,s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl,this.last!==s&&this.bumpLru(s);return}this.max>0&&this.size===this.max&&this.evict();let n={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:r};this.items[t]=n,++this.size===1?this.first=n:this.last.next=n,this.last=n}};async function Y({appId:e,privateKey:t,timeDifference:r,createJwt:n}){try{if(n){let{jwt:i,expiresAt:a}=await n(e,r);return{type:"app",token:i,appId:e,expiresAt:a}}let s={id:e,privateKey:t};r&&Object.assign(s,{now:Math.floor(Date.now()/1e3)+r});let o=await ge(s);return{type:"app",token:o.token,appId:o.appId,expiresAt:new Date(o.expiration*1e3).toISOString()}}catch(s){throw t==="-----BEGIN RSA PRIVATE KEY-----"?new Error("The 'privateKey` option contains only the first line '-----BEGIN RSA PRIVATE KEY-----'. If you are setting it using a `.env` file, make sure it is set on a single line with newlines replaced by '\n'"):s}}function Cr(){return new K(15e3,1e3*60*59)}async function Hr(e,t){let r=ye(t),n=await e.get(r);if(!n)return;let[s,o,i,a,c,p]=n.split("|"),l=t.permissions||c.split(/,/).reduce((u,d)=>(/!$/.test(d)?u[d.slice(0,-1)]="write":u[d]="read",u),{});return{token:s,createdAt:o,expiresAt:i,permissions:l,repositoryIds:t.repositoryIds,repositoryNames:t.repositoryNames,singleFileName:p,repositorySelection:a}}async function Wr(e,t,r){let n=ye(t),s=t.permissions?"":Object.keys(r.permissions).map(i=>`${i}${r.permissions[i]==="write"?"!":""}`).join(","),o=[r.token,r.createdAt,r.expiresAt,r.repositorySelection,s,r.singleFileName].join("|");await e.set(n,o)}function ye({installationId:e,permissions:t={},repositoryIds:r=[],repositoryNames:n=[]}){let s=Object.keys(t).sort().map(a=>t[a]==="read"?a:`${a}!`).join(","),o=r.sort().join(","),i=n.join(",");return[e,o,i,s].filter(Boolean).join("|")}function gt({installationId:e,token:t,createdAt:r,expiresAt:n,repositorySelection:s,permissions:o,repositoryIds:i,repositoryNames:a,singleFileName:c}){return Object.assign({type:"token",tokenType:"installation",token:t,installationId:e,permissions:o,createdAt:r,expiresAt:n,repositorySelection:s},i?{repositoryIds:i}:null,a?{repositoryNames:a}:null,c?{singleFileName:c}:null)}async function yt(e,t,r){let n=Number(t.installationId||e.installationId);if(!n)throw new Error("[@octokit/auth-app] installationId option is required for installation authentication.");if(t.factory){let{type:o,factory:i,oauthApp:a,...c}={...e,...t};return i(c)}let s=r||e.request;return Mr(e,{...t,installationId:n},s)}var J=new Map;function Mr(e,t,r){let n=ye(t);if(J.has(n))return J.get(n);let s=Lr(e,t,r).finally(()=>J.delete(n));return J.set(n,s),s}async function Lr(e,t,r){if(!t.refresh){let w=await Hr(e.cache,t);if(w){let{token:q,createdAt:ee,expiresAt:te,permissions:y,repositoryIds:T,repositoryNames:re,singleFileName:ne,repositorySelection:Ht}=w;return gt({installationId:t.installationId,token:q,createdAt:ee,expiresAt:te,permissions:y,repositorySelection:Ht,repositoryIds:T,repositoryNames:re,singleFileName:ne})}}let n=await Y(e),s={installation_id:t.installationId,mediaType:{previews:["machine-man"]},headers:{authorization:`bearer ${n.token}`}};t.repositoryIds&&Object.assign(s,{repository_ids:t.repositoryIds}),t.repositoryNames&&Object.assign(s,{repositories:t.repositoryNames}),t.permissions&&Object.assign(s,{permissions:t.permissions});let{data:{token:o,expires_at:i,repositories:a,permissions:c,repository_selection:p,single_file:l}}=await r("POST /app/installations/{installation_id}/access_tokens",s),u=c||{},d=p||"all",m=a?a.map(w=>w.id):void 0,x=a?a.map(w=>w.name):void 0,j=new Date().toISOString(),Z={token:o,createdAt:j,expiresAt:i,repositorySelection:d,permissions:u,repositoryIds:m,repositoryNames:x};l&&Object.assign(s,{singleFileName:l}),await Wr(e.cache,t,Z);let I={installationId:t.installationId,token:o,createdAt:j,expiresAt:i,repositorySelection:d,permissions:u,repositoryIds:m,repositoryNames:x};return l&&Object.assign(I,{singleFileName:l}),gt(I)}async function Vr(e,t){switch(t.type){case"app":return Y(e);case"oauth-app":return e.oauthApp({type:"oauth-app"});case"installation":return yt(e,{...t,type:"installation"});case"oauth-user":return e.oauthApp(t);default:throw new Error(`Invalid auth type: ${t.type}`)}}var Br=["/app","/app/hook/config","/app/hook/deliveries","/app/hook/deliveries/{delivery_id}","/app/hook/deliveries/{delivery_id}/attempts","/app/installations","/app/installations/{installation_id}","/app/installations/{installation_id}/access_tokens","/app/installations/{installation_id}/suspended","/app/installation-requests","/marketplace_listing/accounts/{account_id}","/marketplace_listing/plan","/marketplace_listing/plans","/marketplace_listing/plans/{plan_id}/accounts","/marketplace_listing/stubbed/accounts/{account_id}","/marketplace_listing/stubbed/plan","/marketplace_listing/stubbed/plans","/marketplace_listing/stubbed/plans/{plan_id}/accounts","/orgs/{org}/installation","/repos/{owner}/{repo}/installation","/users/{username}/installation"];function Fr(e){let r=`^(?:${e.map(n=>n.split("/").map(s=>s.startsWith("{")?"(?:.+?)":s).join("/")).map(n=>`(?:${n})`).join("|")})$`;return new RegExp(r,"i")}var Kr=Fr(Br);function Jr(e){return!!e&&Kr.test(e.split("?")[0])}var Yr=5*1e3;function Qr(e){return!(e.message.match(/'Expiration time' claim \('exp'\) must be a numeric value representing the future time at which the assertion expires/)||e.message.match(/'Issued at' claim \('iat'\) must be an Integer representing the time that the assertion was issued/))}async function Xr(e,t,r,n){let s=t.endpoint.merge(r,n),o=s.url;if(/\/login\/oauth\/access_token$/.test(o))return t(s);if(Jr(o.replace(t.endpoint.DEFAULTS.baseUrl,""))){let{token:c}=await Y(e);s.headers.authorization=`bearer ${c}`;let p;try{p=await t(s)}catch(l){if(Qr(l)||typeof l.response.headers.date>"u")throw l;let u=Math.floor((Date.parse(l.response.headers.date)-Date.parse(new Date().toString()))/1e3);e.log.warn(l.message),e.log.warn(`[@octokit/auth-app] GitHub API time and system time are different by ${u} seconds. Retrying request with the difference accounted for.`);let{token:d}=await Y({...e,timeDifference:u});return s.headers.authorization=`bearer ${d}`,t(s)}return p}if(N(o)){let c=await e.oauthApp({type:"oauth-app"});return s.headers.authorization=c.headers.authorization,t(s)}let{token:i,createdAt:a}=await yt(e,{},t.defaults({baseUrl:s.baseUrl}));return s.headers.authorization=`token ${i}`,wt(e,t,s,a)}async function wt(e,t,r,n,s=0){let o=+new Date-+new Date(n);try{return await t(r)}catch(i){if(i.status!==401)throw i;if(o>=Yr)throw s>0&&(i.message=`After ${s} retries within ${o/1e3}s of creating the installation access token, the response remains 401. At this point, the cause may be an authentication problem or a system outage. Please check https://www.githubstatus.com for status information`),i;++s;let a=s*1e3;return e.log.warn(`[@octokit/auth-app] Retrying after 401 response to account for token replication delay (retry: ${s}, wait: ${a/1e3}s)`),await new Promise(c=>setTimeout(c,a)),wt(e,t,r,n,s)}}var Zr="8.1.1";function O(e){if(!e.appId)throw new Error("[@octokit/auth-app] appId option is required");if(!e.privateKey&&!e.createJwt)throw new Error("[@octokit/auth-app] privateKey option is required");if(e.privateKey&&e.createJwt)throw new Error("[@octokit/auth-app] privateKey and createJwt options are mutually exclusive");if("installationId"in e&&!e.installationId)throw new Error("[@octokit/auth-app] installationId is set to a falsy value");let t=e.log||{};typeof t.warn!="function"&&(t.warn=console.warn.bind(console));let r=e.request||h.defaults({headers:{"user-agent":`octokit-auth-app.js/${Zr} ${f()}`}}),n=Object.assign({request:r,cache:Cr()},e,e.installationId?{installationId:Number(e.installationId)}:{},{log:t,oauthApp:F({clientType:"github-app",clientId:e.clientId||"",clientSecret:e.clientSecret||"",request:r})});return Object.assign(Vr.bind(null,n),{hook:Xr.bind(null,n)})}async function en(e){return{type:"unauthenticated",reason:e}}function tn(e){return e.status!==403||!e.response?!1:e.response.headers["x-ratelimit-remaining"]==="0"}var rn=/\babuse\b/i;function nn(e){return e.status!==403?!1:rn.test(e.message)}async function sn(e,t,r,n){let s=t.endpoint.merge(r,n);return t(s).catch(o=>{throw o.status===404?(o.message=`Not found. May be due to lack of authentication. Reason: ${e}`,o):tn(o)?(o.message=`API rate limit exceeded. This maybe caused by the lack of authentication. Reason: ${e}`,o):nn(o)?(o.message=`You have triggered an abuse detection mechanism. This maybe caused by the lack of authentication. Reason: ${e}`,o):o.status===401?(o.message=`Unauthorized. "${s.method} ${s.url}" failed most likely due to lack of authentication. Reason: ${e}`,o):(o.status>=400&&o.status<500&&(o.message=o.message.replace(/\.?$/,`. May be caused by lack of authentication (${e}).`)),o)})}var v=function(t){if(!t||!t.reason)throw new Error("[@octokit/auth-unauthenticated] No reason passed to createUnauthenticatedAuth");return Object.assign(en.bind(null,t.reason),{hook:sn.bind(null,t.reason)})};var bt="8.0.2";function _t(e,t,r){if(Array.isArray(t)){for(let n of t)_t(e,n,r);return}e.eventHandlers[t]||(e.eventHandlers[t]=[]),e.eventHandlers[t].push(r)}var on=G.defaults({userAgent:`octokit-oauth-app.js/${bt} ${f()}`});async function _(e,t){let{name:r,action:n}=t;if(e.eventHandlers[`${r}.${n}`])for(let s of e.eventHandlers[`${r}.${n}`])await s(t);if(e.eventHandlers[r])for(let s of e.eventHandlers[r])await s(t)}async function an(e,t){return e.octokit.auth({type:"oauth-user",...t,async factory(r){let n=new e.Octokit({authStrategy:g,auth:r}),s=await n.auth({type:"get"});return await _(e,{name:"token",action:"created",token:s.token,scopes:s.scopes,authentication:s,octokit:n}),n}})}function cn(e,t){let r={clientId:e.clientId,request:e.octokit.request,...t,allowSignup:e.allowSignup??t.allowSignup,redirectUrl:t.redirectUrl??e.redirectUrl,scopes:t.scopes??e.defaultScopes};return Ze({clientType:e.clientType,...r})}async function un(e,t){let r=await e.octokit.auth({type:"oauth-user",...t});return await _(e,{name:"token",action:"created",token:r.token,scopes:r.scopes,authentication:r,octokit:new e.Octokit({authStrategy:g,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:r.token,scopes:r.scopes,refreshToken:r.refreshToken,expiresAt:r.expiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt}})}),{authentication:r}}async function ln(e,t){let r=await V({clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...t});return Object.assign(r.authentication,{type:"token",tokenType:"oauth"}),r}async function pn(e,t){let r={clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...t};if(e.clientType==="oauth-app"){let o=await U({clientType:"oauth-app",...r}),i=Object.assign(o.authentication,{type:"token",tokenType:"oauth"});return await _(e,{name:"token",action:"reset",token:o.authentication.token,scopes:o.authentication.scopes||void 0,authentication:i,octokit:new e.Octokit({authStrategy:g,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:o.authentication.token,scopes:o.authentication.scopes}})}),{...o,authentication:i}}let n=await U({clientType:"github-app",...r}),s=Object.assign(n.authentication,{type:"token",tokenType:"oauth"});return await _(e,{name:"token",action:"reset",token:n.authentication.token,authentication:s,octokit:new e.Octokit({authStrategy:g,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:n.authentication.token}})}),{...n,authentication:s}}async function dn(e,t){if(e.clientType==="oauth-app")throw new Error("[@octokit/oauth-app] app.refreshToken() is not supported for OAuth Apps");let r=await B({clientType:"github-app",clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,refreshToken:t.refreshToken}),n=Object.assign(r.authentication,{type:"token",tokenType:"oauth"});return await _(e,{name:"token",action:"refreshed",token:r.authentication.token,authentication:n,octokit:new e.Octokit({authStrategy:g,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:r.authentication.token}})}),{...r,authentication:n}}async function hn(e,t){if(e.clientType==="oauth-app")throw new Error("[@octokit/oauth-app] app.scopeToken() is not supported for OAuth Apps");let r=await rt({clientType:"github-app",clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...t}),n=Object.assign(r.authentication,{type:"token",tokenType:"oauth"});return await _(e,{name:"token",action:"scoped",token:r.authentication.token,authentication:n,octokit:new e.Octokit({authStrategy:g,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:r.authentication.token}})}),{...r,authentication:n}}async function fn(e,t){let r={clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...t},n=e.clientType==="oauth-app"?await z({clientType:"oauth-app",...r}):await z({clientType:"github-app",...r});return await _(e,{name:"token",action:"deleted",token:t.token,octokit:new e.Octokit({authStrategy:v,auth:{reason:'Handling "token.deleted" event. The access for the token has been revoked.'}})}),n}async function mn(e,t){let r={clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...t},n=e.clientType==="oauth-app"?await P({clientType:"oauth-app",...r}):await P({clientType:"github-app",...r});return await _(e,{name:"token",action:"deleted",token:t.token,octokit:new e.Octokit({authStrategy:v,auth:{reason:'Handling "token.deleted" event. The access for the token has been revoked.'}})}),await _(e,{name:"authorization",action:"deleted",token:t.token,octokit:new e.Octokit({authStrategy:v,auth:{reason:'Handling "authorization.deleted" event. The access for the app has been revoked.'}})}),n}function gn(e){return{status:404,headers:{"content-type":"application/json"},text:JSON.stringify({error:`Unknown route: ${e.method} ${e.url}`})}}async function yn(e,{pathPrefix:t="/api/github/oauth"},r){let{pathname:n}=new URL(r.url,"http://localhost");if(!n.startsWith(`${t}/`))return;if(r.method==="OPTIONS")return{status:200,headers:{"access-control-allow-origin":"*","access-control-allow-methods":"*","access-control-allow-headers":"Content-Type, User-Agent, Authorization"}};n=n.slice(t.length+1);let s=[r.method,n].join(" "),o={getLogin:"GET login",getCallback:"GET callback",createToken:"POST token",getToken:"GET token",patchToken:"PATCH token",patchRefreshToken:"PATCH refresh-token",scopeToken:"POST token/scoped",deleteToken:"DELETE token",deleteGrant:"DELETE grant"};if(!Object.values(o).includes(s))return gn(r);let i;try{let l=await r.text();i=l?JSON.parse(l):{}}catch{return{status:400,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify({error:"[@octokit/oauth-app] request error"})}}let{searchParams:a}=new URL(r.url,"http://localhost"),c=Object.fromEntries(a),p=r.headers;try{if(s===o.getLogin){let u={};c.state&&Object.assign(u,{state:c.state}),c.scopes&&Object.assign(u,{scopes:c.scopes.split(",")}),c.allowSignup&&Object.assign(u,{allowSignup:c.allowSignup==="true"}),c.redirectUrl&&Object.assign(u,{redirectUrl:c.redirectUrl});let{url:d}=e.getWebFlowAuthorizationUrl(u);return{status:302,headers:{location:d}}}if(s===o.getCallback){if(c.error)throw new Error(`[@octokit/oauth-app] ${c.error} ${c.error_description}`);if(!c.code)throw new Error('[@octokit/oauth-app] "code" parameter is required');let{authentication:{token:u}}=await e.createToken({code:c.code});return{status:200,headers:{"content-type":"text/html"},text:`<h1>Token created successfully</h1>

<p>Your token is: <strong>${u}</strong>. Copy it now as it cannot be shown again.</p>`}}if(s===o.createToken){let{code:u,redirectUrl:d}=i;if(!u)throw new Error('[@octokit/oauth-app] "code" parameter is required');let m=await e.createToken({code:u,redirectUrl:d});return delete m.authentication.clientSecret,{status:201,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(m)}}if(s===o.getToken){let u=p.authorization?.substr(6);if(!u)throw new Error('[@octokit/oauth-app] "Authorization" header is required');let d=await e.checkToken({token:u});return delete d.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(d)}}if(s===o.patchToken){let u=p.authorization?.substr(6);if(!u)throw new Error('[@octokit/oauth-app] "Authorization" header is required');let d=await e.resetToken({token:u});return delete d.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(d)}}if(s===o.patchRefreshToken){if(!p.authorization?.substr(6))throw new Error('[@octokit/oauth-app] "Authorization" header is required');let{refreshToken:d}=i;if(!d)throw new Error("[@octokit/oauth-app] refreshToken must be sent in request body");let m=await e.refreshToken({refreshToken:d});return delete m.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(m)}}if(s===o.scopeToken){let u=p.authorization?.substr(6);if(!u)throw new Error('[@octokit/oauth-app] "Authorization" header is required');let d=await e.scopeToken({token:u,...i});return delete d.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(d)}}if(s===o.deleteToken){let u=p.authorization?.substr(6);if(!u)throw new Error('[@octokit/oauth-app] "Authorization" header is required');return await e.deleteToken({token:u}),{status:204,headers:{"access-control-allow-origin":"*"}}}let l=p.authorization?.substr(6);if(!l)throw new Error('[@octokit/oauth-app] "Authorization" header is required');return await e.deleteAuthorization({token:l}),{status:204,headers:{"access-control-allow-origin":"*"}}}catch(l){return{status:400,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify({error:l.message})}}}function wn(e){let t=Object.fromEntries(e.headers.entries());return{method:e.method,url:e.url,headers:t,text:()=>e.text()}}function bn(e){let t={status:e.status};return e.headers&&Object.assign(t,{headers:e.headers}),new Response(e.text,t)}function Tt(e,t={}){return async function(r){let n=await wn(r),s=await yn(e,t,n);return s?bn(s):void 0}}var kt=class{static VERSION=bt;static defaults(e){return class extends this{constructor(...r){super({...e,...r[0]})}}}constructor(e){let t=e.Octokit||on;this.type=e.clientType||"oauth-app";let r=new t({authStrategy:F,auth:{clientType:this.type,clientId:e.clientId,clientSecret:e.clientSecret}}),n={clientType:this.type,clientId:e.clientId,clientSecret:e.clientSecret,defaultScopes:e.defaultScopes||[],allowSignup:e.allowSignup,baseUrl:e.baseUrl,redirectUrl:e.redirectUrl,log:e.log,Octokit:t,octokit:r,eventHandlers:{}};this.on=_t.bind(null,n),this.octokit=r,this.getUserOctokit=an.bind(null,n),this.getWebFlowAuthorizationUrl=cn.bind(null,n),this.createToken=un.bind(null,n),this.checkToken=ln.bind(null,n),this.resetToken=pn.bind(null,n),this.refreshToken=dn.bind(null,n),this.scopeToken=hn.bind(null,n),this.deleteToken=fn.bind(null,n),this.deleteAuthorization=mn.bind(null,n)}type;on;octokit;getUserOctokit;getWebFlowAuthorizationUrl;createToken;checkToken;resetToken;refreshToken;scopeToken;deleteToken;deleteAuthorization};import{createHmac as _n}from"node:crypto";import{timingSafeEqual as Tn}from"node:crypto";import{Buffer as Et}from"node:buffer";var vt="6.0.0";async function Q(e,t){if(!e||!t)throw new TypeError("[@octokit/webhooks-methods] secret & payload required for sign()");if(typeof t!="string")throw new TypeError("[@octokit/webhooks-methods] payload must be a string");let r="sha256";return`${r}=${_n(r,e).update(t).digest("hex")}`}Q.VERSION=vt;async function D(e,t,r){if(!e||!t||!r)throw new TypeError("[@octokit/webhooks-methods] secret, eventPayload & signature required");if(typeof t!="string")throw new TypeError("[@octokit/webhooks-methods] eventPayload must be a string");let n=Et.from(r),s=Et.from(await Q(e,t));return n.length!==s.length?!1:Tn(n,s)}D.VERSION=vt;async function At(e,t,r,n){if(await D(e,t,r))return!0;if(n!==void 0)for(let o of n){let i=await D(o,t,r);if(i)return i}return!1}var we=(e={})=>(typeof e.debug!="function"&&(e.debug=()=>{}),typeof e.info!="function"&&(e.info=()=>{}),typeof e.warn!="function"&&(e.warn=console.warn.bind(console)),typeof e.error!="function"&&(e.error=console.error.bind(console)),e),kn=["branch_protection_configuration","branch_protection_configuration.disabled","branch_protection_configuration.enabled","branch_protection_rule","branch_protection_rule.created","branch_protection_rule.deleted","branch_protection_rule.edited","check_run","check_run.completed","check_run.created","check_run.requested_action","check_run.rerequested","check_suite","check_suite.completed","check_suite.requested","check_suite.rerequested","code_scanning_alert","code_scanning_alert.appeared_in_branch","code_scanning_alert.closed_by_user","code_scanning_alert.created","code_scanning_alert.fixed","code_scanning_alert.reopened","code_scanning_alert.reopened_by_user","commit_comment","commit_comment.created","create","custom_property","custom_property.created","custom_property.deleted","custom_property.promote_to_enterprise","custom_property.updated","custom_property_values","custom_property_values.updated","delete","dependabot_alert","dependabot_alert.auto_dismissed","dependabot_alert.auto_reopened","dependabot_alert.created","dependabot_alert.dismissed","dependabot_alert.fixed","dependabot_alert.reintroduced","dependabot_alert.reopened","deploy_key","deploy_key.created","deploy_key.deleted","deployment","deployment.created","deployment_protection_rule","deployment_protection_rule.requested","deployment_review","deployment_review.approved","deployment_review.rejected","deployment_review.requested","deployment_status","deployment_status.created","discussion","discussion.answered","discussion.category_changed","discussion.closed","discussion.created","discussion.deleted","discussion.edited","discussion.labeled","discussion.locked","discussion.pinned","discussion.reopened","discussion.transferred","discussion.unanswered","discussion.unlabeled","discussion.unlocked","discussion.unpinned","discussion_comment","discussion_comment.created","discussion_comment.deleted","discussion_comment.edited","fork","github_app_authorization","github_app_authorization.revoked","gollum","installation","installation.created","installation.deleted","installation.new_permissions_accepted","installation.suspend","installation.unsuspend","installation_repositories","installation_repositories.added","installation_repositories.removed","installation_target","installation_target.renamed","issue_comment","issue_comment.created","issue_comment.deleted","issue_comment.edited","issues","issues.assigned","issues.closed","issues.deleted","issues.demilestoned","issues.edited","issues.labeled","issues.locked","issues.milestoned","issues.opened","issues.pinned","issues.reopened","issues.transferred","issues.typed","issues.unassigned","issues.unlabeled","issues.unlocked","issues.unpinned","issues.untyped","label","label.created","label.deleted","label.edited","marketplace_purchase","marketplace_purchase.cancelled","marketplace_purchase.changed","marketplace_purchase.pending_change","marketplace_purchase.pending_change_cancelled","marketplace_purchase.purchased","member","member.added","member.edited","member.removed","membership","membership.added","membership.removed","merge_group","merge_group.checks_requested","merge_group.destroyed","meta","meta.deleted","milestone","milestone.closed","milestone.created","milestone.deleted","milestone.edited","milestone.opened","org_block","org_block.blocked","org_block.unblocked","organization","organization.deleted","organization.member_added","organization.member_invited","organization.member_removed","organization.renamed","package","package.published","package.updated","page_build","personal_access_token_request","personal_access_token_request.approved","personal_access_token_request.cancelled","personal_access_token_request.created","personal_access_token_request.denied","ping","project","project.closed","project.created","project.deleted","project.edited","project.reopened","project_card","project_card.converted","project_card.created","project_card.deleted","project_card.edited","project_card.moved","project_column","project_column.created","project_column.deleted","project_column.edited","project_column.moved","projects_v2","projects_v2.closed","projects_v2.created","projects_v2.deleted","projects_v2.edited","projects_v2.reopened","projects_v2_item","projects_v2_item.archived","projects_v2_item.converted","projects_v2_item.created","projects_v2_item.deleted","projects_v2_item.edited","projects_v2_item.reordered","projects_v2_item.restored","projects_v2_status_update","projects_v2_status_update.created","projects_v2_status_update.deleted","projects_v2_status_update.edited","public","pull_request","pull_request.assigned","pull_request.auto_merge_disabled","pull_request.auto_merge_enabled","pull_request.closed","pull_request.converted_to_draft","pull_request.demilestoned","pull_request.dequeued","pull_request.edited","pull_request.enqueued","pull_request.labeled","pull_request.locked","pull_request.milestoned","pull_request.opened","pull_request.ready_for_review","pull_request.reopened","pull_request.review_request_removed","pull_request.review_requested","pull_request.synchronize","pull_request.unassigned","pull_request.unlabeled","pull_request.unlocked","pull_request_review","pull_request_review.dismissed","pull_request_review.edited","pull_request_review.submitted","pull_request_review_comment","pull_request_review_comment.created","pull_request_review_comment.deleted","pull_request_review_comment.edited","pull_request_review_thread","pull_request_review_thread.resolved","pull_request_review_thread.unresolved","push","registry_package","registry_package.published","registry_package.updated","release","release.created","release.deleted","release.edited","release.prereleased","release.published","release.released","release.unpublished","repository","repository.archived","repository.created","repository.deleted","repository.edited","repository.privatized","repository.publicized","repository.renamed","repository.transferred","repository.unarchived","repository_advisory","repository_advisory.published","repository_advisory.reported","repository_dispatch","repository_dispatch.sample.collected","repository_import","repository_ruleset","repository_ruleset.created","repository_ruleset.deleted","repository_ruleset.edited","repository_vulnerability_alert","repository_vulnerability_alert.create","repository_vulnerability_alert.dismiss","repository_vulnerability_alert.reopen","repository_vulnerability_alert.resolve","secret_scanning_alert","secret_scanning_alert.created","secret_scanning_alert.publicly_leaked","secret_scanning_alert.reopened","secret_scanning_alert.resolved","secret_scanning_alert.validated","secret_scanning_alert_location","secret_scanning_alert_location.created","secret_scanning_scan","secret_scanning_scan.completed","security_advisory","security_advisory.published","security_advisory.updated","security_advisory.withdrawn","security_and_analysis","sponsorship","sponsorship.cancelled","sponsorship.created","sponsorship.edited","sponsorship.pending_cancellation","sponsorship.pending_tier_change","sponsorship.tier_changed","star","star.created","star.deleted","status","sub_issues","sub_issues.parent_issue_added","sub_issues.parent_issue_removed","sub_issues.sub_issue_added","sub_issues.sub_issue_removed","team","team.added_to_repository","team.created","team.deleted","team.edited","team.removed_from_repository","team_add","watch","watch.started","workflow_dispatch","workflow_job","workflow_job.completed","workflow_job.in_progress","workflow_job.queued","workflow_job.waiting","workflow_run","workflow_run.completed","workflow_run.in_progress","workflow_run.requested"];function En(e,t={}){if(typeof e!="string")throw new TypeError("eventName must be of type string");if(e==="*")throw new TypeError('Using the "*" event with the regular Webhooks.on() function is not supported. Please use the Webhooks.onAny() method instead');if(e==="error")throw new TypeError('Using the "error" event with the regular Webhooks.on() function is not supported. Please use the Webhooks.onError() method instead');if(t.onUnknownEventName!=="ignore"&&!kn.includes(e)){if(t.onUnknownEventName!=="warn")throw new TypeError(`"${e}" is not a known webhook name (https://developer.github.com/v3/activity/events/types/)`);(t.log||console).warn(`"${e}" is not a known webhook name (https://developer.github.com/v3/activity/events/types/)`)}}function be(e,t,r){e.hooks[t]||(e.hooks[t]=[]),e.hooks[t].push(r)}function xt(e,t,r){if(Array.isArray(t)){t.forEach(n=>xt(e,n,r));return}En(t,{onUnknownEventName:"warn",log:e.log}),be(e,t,r)}function vn(e,t){be(e,"*",t)}function An(e,t){be(e,"error",t)}function St(e,t){let r;try{r=e(t)}catch(n){console.log('FATAL: Error occurred in "error" event handler'),console.log(n)}r&&r.catch&&r.catch(n=>{console.log('FATAL: Error occurred in "error" event handler'),console.log(n)})}function Sn(e,t,r){let n=[e.hooks[r],e.hooks["*"]];return t&&n.unshift(e.hooks[`${r}.${t}`]),[].concat(...n.filter(Boolean))}function Gn(e,t){let r=e.hooks.error||[];if(t instanceof Error){let i=Object.assign(new AggregateError([t],t.message),{event:t});return r.forEach(a=>St(a,i)),Promise.reject(i)}if(!t||!t.name){let i=new Error("Event name not passed");throw new AggregateError([i],i.message)}if(!t.payload){let i=new Error("Event name not passed");throw new AggregateError([i],i.message)}let n=Sn(e,"action"in t.payload?t.payload.action:null,t.name);if(n.length===0)return Promise.resolve();let s=[],o=n.map(i=>{let a=Promise.resolve(t);return e.transform&&(a=a.then(e.transform)),a.then(c=>i(c)).catch(c=>s.push(Object.assign(c,{event:t})))});return Promise.all(o).then(()=>{if(s.length===0)return;let i=new AggregateError(s,s.map(a=>a.message).join(`
`));throw Object.assign(i,{event:t}),r.forEach(a=>St(a,i)),i})}function jt(e,t,r){if(Array.isArray(t)){t.forEach(n=>jt(e,n,r));return}if(e.hooks[t]){for(let n=e.hooks[t].length-1;n>=0;n--)if(e.hooks[t][n]===r){e.hooks[t].splice(n,1);return}}}function On(e){let t={hooks:{},log:we(e&&e.log)};return e&&e.transform&&(t.transform=e.transform),{on:xt.bind(null,t),onAny:vn.bind(null,t),onError:An.bind(null,t),removeListener:jt.bind(null,t),receive:Gn.bind(null,t)}}async function xn(e,t){if(!await At(e.secret,t.payload,t.signature,e.additionalSecrets).catch(()=>!1)){let s=new Error("[@octokit/webhooks] signature does not match event payload and secret");return s.event=t,s.status=400,e.eventHandler.receive(s)}let n;try{n=JSON.parse(t.payload)}catch(s){throw s.message="Invalid JSON",s.status=400,new AggregateError([s],s.message)}return e.eventHandler.receive({id:t.id,name:t.name,payload:n})}function Gt(e){let t=e.length;if(t===0)return"/";for(;t>0&&e.charCodeAt(--t)===47;);return t===-1?"/":e.slice(0,t+1)}var jn=/^\s*(application\/json)\s*(?:;|$)/u,In=["x-github-event","x-hub-signature-256","x-github-delivery"];function qn(e){let{handleResponse:t,getRequestHeader:r,getPayload:n}=e;return function(o,i){let a=Gt(i.path);return async function(p,l,u){let d;try{d=new URL(Gt(p.url),"http://localhost").pathname}catch{return t(JSON.stringify({error:`Request URL could not be parsed: ${p.url}`}),422,{"content-type":"application/json"},l)}if(d!==a)return u?.(),t(null);if(p.method!=="POST")return t(JSON.stringify({error:`Unknown route: ${p.method} ${d}`}),404,{"content-type":"application/json"},l);let m=r(p,"content-type");if(typeof m!="string"||!jn.test(m))return t(JSON.stringify({error:'Unsupported "Content-Type" header value. Must be "application/json"'}),415,{"content-type":"application/json",accept:"application/json"},l);let x=In.filter(y=>r(p,y)==null).join(", ");if(x)return t(JSON.stringify({error:`Required headers missing: ${x}`}),400,{"content-type":"application/json",accept:"application/json"},l);let j=r(p,"x-github-event"),Z=r(p,"x-hub-signature-256"),I=r(p,"x-github-delivery");i.log.debug(`${j} event received (id: ${I})`);let w=!1,q,ee=new Promise(y=>{q=setTimeout(()=>{w=!0,y(t(`still processing
`,202,{"Content-Type":"text/plain",accept:"application/json"},l))},i.timeout)}),te=async()=>{try{let y=await n(p);return await o.verifyAndReceive({id:I,name:j,payload:y,signature:Z}),clearTimeout(q),w?t(null):t(`ok
`,200,{"content-type":"text/plain",accept:"application/json"},l)}catch(y){if(clearTimeout(q),w)return t(null);let T=Array.from(y.errors)[0],re=T.message?`${T.name}: ${T.message}`:"Error: An Unspecified error occurred",ne=typeof T.status<"u"?T.status:500;return i.log.error(y),t(JSON.stringify({error:re}),ne,{"content-type":"application/json",accept:"application/json"},l)}};return await Promise.race([ee,te()])}}}var Ot=new TextDecoder("utf-8",{fatal:!1}),Co=Ot.decode.bind(Ot);function $n(e){return e.text()}function Rn(e,t){return e.headers.get(t)}function Un(e,t=200,r={}){return e!==null&&(r["content-length"]=e.length.toString()),new Response(e,{status:t,headers:r})}function It(e,{path:t="/api/github/webhooks",log:r=we(),timeout:n=9e3}={}){return qn({handleResponse:Un,getRequestHeader:Rn,getPayload:$n})(e,{path:t,log:r,timeout:n})}var qt=class{sign;verify;on;onAny;onError;removeListener;receive;verifyAndReceive;constructor(e){if(!e||!e.secret)throw new Error("[@octokit/webhooks] options.secret required");let t={eventHandler:On(e),secret:e.secret,additionalSecrets:e.additionalSecrets,hooks:{},log:we(e.log)};this.sign=Q.bind(null,e.secret),this.verify=D.bind(null,e.secret),this.on=t.eventHandler.on,this.onAny=t.eventHandler.onAny,this.onError=t.eventHandler.onError,this.removeListener=t.eventHandler.removeListener,this.receive=t.eventHandler.receive,this.verifyAndReceive=xn.bind(null,t)}};var zn="0.0.0-development";function Pn(e){if(!e.data)return{...e,data:[]};if(!(("total_count"in e.data||"total_commits"in e.data)&&!("url"in e.data)))return e;let r=e.data.incomplete_results,n=e.data.repository_selection,s=e.data.total_count,o=e.data.total_commits;delete e.data.incomplete_results,delete e.data.repository_selection,delete e.data.total_count,delete e.data.total_commits;let i=Object.keys(e.data)[0],a=e.data[i];return e.data=a,typeof r<"u"&&(e.data.incomplete_results=r),typeof n<"u"&&(e.data.repository_selection=n),e.data.total_count=s,e.data.total_commits=o,e}function _e(e,t,r){let n=typeof t=="function"?t.endpoint(r):e.request.endpoint(t,r),s=typeof t=="function"?t:e.request,o=n.method,i=n.headers,a=n.url;return{[Symbol.asyncIterator]:()=>({async next(){if(!a)return{done:!0};try{let c=await s({method:o,url:a,headers:i}),p=Pn(c);if(a=((p.headers.link||"").match(/<([^<>]+)>;\s*rel="next"/)||[])[1],!a&&"total_commits"in p.data){let l=new URL(p.url),u=l.searchParams,d=parseInt(u.get("page")||"1",10),m=parseInt(u.get("per_page")||"250",10);d*m<p.data.total_commits&&(u.set("page",String(d+1)),a=l.toString())}return{value:p}}catch(c){if(c.status!==409)throw c;return a="",{value:{status:200,headers:{},data:[]}}}}})}}function $t(e,t,r,n){return typeof r=="function"&&(n=r,r=void 0),Rt(e,[],_e(e,t,r)[Symbol.asyncIterator](),n)}function Rt(e,t,r,n){return r.next().then(s=>{if(s.done)return t;let o=!1;function i(){o=!0}return t=t.concat(n?n(s.value,i):s.value.data),o?t:Rt(e,t,r,n)})}var X=Object.assign($t,{iterator:_e});function Nn(e){return{paginate:Object.assign($t.bind(null,e),{iterator:_e.bind(null,e)})}}Nn.VERSION=zn;var Dn="0.0.0-development";function Cn(e,t){return new qt({secret:t.secret,transform:async r=>{if(!("installation"in r.payload)||typeof r.payload.installation!="object"){let o=new e.constructor({authStrategy:v,auth:{reason:'"installation" key missing in webhook event payload'}});return{...r,octokit:o}}let n=r.payload.installation.id,s=await e.auth({type:"installation",installationId:n,factory(o){return new o.octokit.constructor({...o.octokitOptions,authStrategy:O,auth:{...o,installationId:n}})}});return s.hook.before("request",o=>{o.headers["x-github-delivery"]=r.id}),{...r,octokit:s}}})}async function zt(e,t){return e.octokit.auth({type:"installation",installationId:t,factory(r){let n={...r.octokitOptions,authStrategy:O,auth:{...r,installationId:t}};return new r.octokit.constructor(n)}})}function Hn(e){return Object.assign(Wn.bind(null,e),{iterator:Pt.bind(null,e)})}async function Wn(e,t){let r=Pt(e)[Symbol.asyncIterator](),n=await r.next();for(;!n.done;)await t(n.value),n=await r.next()}function Pt(e){return{async*[Symbol.asyncIterator](){let t=X.iterator(e.octokit,"GET /app/installations");for await(let{data:r}of t)for(let n of r)yield{octokit:await zt(e,n.id),installation:n}}}}function Mn(e){return Object.assign(Ln.bind(null,e),{iterator:Nt.bind(null,e)})}async function Ln(e,t,r){let n=Nt(e,r?t:void 0)[Symbol.asyncIterator](),s=await n.next();for(;!s.done;)r?await r(s.value):await t(s.value),s=await n.next()}function Vn(e,t){return{async*[Symbol.asyncIterator](){yield{octokit:await e.getInstallationOctokit(t)}}}}function Nt(e,t){return{async*[Symbol.asyncIterator](){let r=t?Vn(e,t.installationId):e.eachInstallation.iterator();for await(let{octokit:n}of r){let s=X.iterator(n,"GET /installation/repositories");for await(let{data:o}of s)for(let i of o)yield{octokit:n,repository:i}}}}}function Bn(e){let t;return async function(n={}){t||(t=Fn(e));let s=await t,o=new URL(s);return n.target_id!==void 0&&(o.pathname+="/permissions",o.searchParams.append("target_id",n.target_id.toFixed())),n.state!==void 0&&o.searchParams.append("state",n.state),o.href}}async function Fn(e){let{data:t}=await e.octokit.request("GET /app");if(!t)throw new Error("[@octokit/app] unable to fetch metadata for app");return`${t.html_url}/installations/new`}function Ut(){}function Dt(e,t={}){let r=Object.assign({debug:Ut,info:Ut,warn:console.warn.bind(console),error:console.error.bind(console)},t.log),n={pathPrefix:"/api/github",...t,log:r},s=It(e.webhooks,{path:n.pathPrefix+"/webhooks",log:r}),o=Tt(e.oauth,{pathPrefix:n.pathPrefix+"/oauth"});return Kn.bind(null,n.pathPrefix,s,o)}async function Kn(e,t,r,n){let{pathname:s}=new URL(n.url,"http://localhost");if(s.startsWith(`${e}/`))return s===`${e}/webhooks`?t(n):s.startsWith(`${e}/oauth/`)?r(n):new Response(JSON.stringify({error:`Unknown route: ${n.method} ${n.url}`}),{status:404,headers:{"content-type":"application/json"}})}var Ct=class{static VERSION=Dn;static defaults(e){return class extends this{constructor(...r){super({...e,...r[0]})}}}octokit;webhooks;oauth;getInstallationOctokit;eachInstallation;eachRepository;getInstallationUrl;log;constructor(e){let t=e.Octokit||G,r=Object.assign({appId:e.appId,privateKey:e.privateKey},e.oauth?{clientId:e.oauth.clientId,clientSecret:e.oauth.clientSecret}:{}),n={authStrategy:O,auth:r};"log"in e&&typeof e.log<"u"&&(n.log=e.log),this.octokit=new t(n),this.log=Object.assign({debug:()=>{},info:()=>{},warn:console.warn.bind(console),error:console.error.bind(console)},e.log),e.webhooks?this.webhooks=Cn(this.octokit,e.webhooks):Object.defineProperty(this,"webhooks",{get(){throw new Error("[@octokit/app] webhooks option not set")}}),e.oauth?this.oauth=new kt({...e.oauth,clientType:"github-app",Octokit:t}):Object.defineProperty(this,"oauth",{get(){throw new Error("[@octokit/app] oauth.clientId / oauth.clientSecret options are not set")}}),this.getInstallationOctokit=zt.bind(null,this),this.eachInstallation=Hn(this),this.eachRepository=Mn(this),this.getInstallationUrl=Bn(this)}};var Jn=new Ct({appId:ESBUILDENV.APPID,privateKey:ESBUILDENV.PRIVATE_KEY,webhooks:{secret:ESBUILDENV.WEBHOOK_SECRET}}),Yn=Dt(Jn),oi={async fetch(e){return Yn(e)}};export{oi as default};
/*! Bundled license information:

toad-cache/dist/toad-cache.mjs:
  (**
   * toad-cache
   *
   * @copyright 2024 Igor Savin <kibertoad@gmail.com>
   * @license MIT
   * @version 3.7.0
   *)
*/
